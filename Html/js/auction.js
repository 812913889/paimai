/*!
 * M.YS.COM v0.0.0
 * Copyright 2015
 * Author burning <iburning@live.cn>
 */
var Auction=function(a){var b=this;b.DEFUATL={el:null,productId:null,auctionApi:"",auctionStep:1,auctionCount:0,onAuction:null,inputValue:0,isEditedByUser:!1},a&&b.init(a)};Auction.prototype.init=function(a){var b=this;$.extend(b,b.DEFUATL,a||{});var c=b.el;b.priceInput=c.find(".price").eq(0),b.decreaseButton=c.find(".btn-decrease").eq(0),b.increaseButton=c.find(".btn-increase").eq(0),b.submitButton=c.find(".btn-submit").eq(0);var d=b.inputValue;b.auctionCount>0?b.minPrice=d+b.getStep(d):0===d?b.minPrice=b.getStep(d):b.minPrice=d,b.setPrice(b.minPrice),b._bindEvent()},Auction.prototype._bindEvent=function(){var a=this;a.priceInput.on("click",function(b){a.isEditedByUser=!0}),a.decreaseButton.on("click",function(b){a.isEditedByUser=!0;var c=a.getPrice();c-=a.getStep(c),c<a.minPrice||a.setPrice(c)}),a.increaseButton.on("click",function(b){a.isEditedByUser=!0;var c=a.getPrice();c+=a.getStep(c),a.setPrice(c)}),a.submitButton.on("click",function(b){a.submit()})},Auction.prototype.submit=function(){var a=this;utils.checkLogin(function(){var b=a.getPrice();return b<a.minPrice?(utils.showAlert({content:'出价至少为<span class="money"><i>&yen;</i><em>'+a.minPrice+"</em></span>"}),void a.setPrice(a.minPrice)):(a.submitButton.addClass("am-disabled"),void utils.ajax({url:a.auctionApi,data:{productId:a.productId,price:b},success:function(b){a.submitButton.removeClass("am-disabled"),"function"==typeof a.onAuction&&a.onAuction(b)},error:function(b){a.submitButton.removeClass("am-disabled"),utils.showAlert({content:"系统异常，请稍后重试"})}}))})},Auction.prototype.getPrice=function(){var a=this,b=parseInt(a.priceInput.val())||0;return b=b<a.inputValue?a.inputValue:b},Auction.prototype.setPrice=function(a){var b=this;a=parseInt(a),b.inputValue=a,b.priceInput.val(a)},Auction.prototype.getStep=function(a){var b=this;return b.auctionStep};